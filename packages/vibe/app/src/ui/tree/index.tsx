import React, { useId } from "react";
import { useVibeContext } from "../../exports.js";
import { Category } from "../../types.js";

import "./index.scss";

const PlusSquareIcon = () => (
    <svg
        color='rgb(var(--foreground, 0, 0, 0))'
        viewBox='0 0 14 14'
        fill='none'
        xmlns='http://www.w3.org/2000/svg'
    >
        <path
            d='M2.38783 14H11.6122C12.4081 14 13.0038 13.8023 13.3992 13.4068C13.7997 13.0165 14 12.4284 14 11.6426V2.35741C14 1.57161 13.7997 0.983523 13.3992 0.593156C13.0038 0.197719 12.4081 0 11.6122 0H2.38783C1.59189 0 0.993663 0.197719 0.593156 0.593156C0.197719 0.983523 0 1.57161 0 2.35741V11.6426C0 12.4284 0.197719 13.0165 0.593156 13.4068C0.993663 13.8023 1.59189 14 2.38783 14ZM2.40304 12.7757C2.02281 12.7757 1.73131 12.6768 1.52852 12.4791C1.32573 12.2763 1.22433 11.9772 1.22433 11.5817V2.41825C1.22433 2.02281 1.32573 1.72624 1.52852 1.52852C1.73131 1.32573 2.02281 1.22433 2.40304 1.22433H11.597C11.9721 1.22433 12.2611 1.32573 12.4639 1.52852C12.6717 1.72624 12.7757 2.02281 12.7757 2.41825V11.5817C12.7757 11.9772 12.6717 12.2763 12.4639 12.4791C12.2611 12.6768 11.9721 12.7757 11.597 12.7757H2.40304ZM3.48289 6.98859C3.48289 7.1711 3.54373 7.32066 3.6654 7.43726C3.78707 7.55387 3.94423 7.61217 4.13688 7.61217H6.37262V9.85551C6.37262 10.0482 6.43092 10.2053 6.54753 10.327C6.66413 10.4436 6.81369 10.5019 6.9962 10.5019C7.18885 10.5019 7.34347 10.4436 7.46008 10.327C7.58175 10.2053 7.64259 10.0482 7.64259 9.85551V7.61217H9.88593C10.0786 7.61217 10.2332 7.55387 10.3498 7.43726C10.4715 7.32066 10.5323 7.1711 10.5323 6.98859C10.5323 6.79594 10.4715 6.64132 10.3498 6.52471C10.2332 6.40304 10.0786 6.34221 9.88593 6.34221H7.64259V4.10646C7.64259 3.90875 7.58175 3.75158 7.46008 3.63498C7.34347 3.51331 7.18885 3.45247 6.9962 3.45247C6.81369 3.45247 6.66413 3.51331 6.54753 3.63498C6.43092 3.75665 6.37262 3.91382 6.37262 4.10646V6.34221H4.13688C3.93916 6.34221 3.77947 6.40304 3.65779 6.52471C3.54119 6.64132 3.48289 6.79594 3.48289 6.98859Z'
            fill='currentColor'
        />
    </svg>
);
const MinusSquareIcon = () => (
    <svg
        color='rgb(var(--foreground, 0, 0, 0))'
        viewBox='0 0 14 14'
        fill='none'
        xmlns='http://www.w3.org/2000/svg'
    >
        <path
            d='M2.38783 14H11.6122C12.4081 14 13.0038 13.8023 13.3992 13.4068C13.7997 13.0165 14 12.4284 14 11.6426V2.35741C14 1.57161 13.7997 0.983523 13.3992 0.593156C13.0038 0.197719 12.4081 0 11.6122 0H2.38783C1.59189 0 0.993663 0.197719 0.593156 0.593156C0.197719 0.983523 0 1.57161 0 2.35741V11.6426C0 12.4284 0.197719 13.0165 0.593156 13.4068C0.993663 13.8023 1.59189 14 2.38783 14ZM2.40304 12.7757C2.02281 12.7757 1.73131 12.6768 1.52852 12.4791C1.32573 12.2763 1.22433 11.9772 1.22433 11.5817V2.41825C1.22433 2.02281 1.32573 1.72624 1.52852 1.52852C1.73131 1.32573 2.02281 1.22433 2.40304 1.22433H11.597C11.9721 1.22433 12.2611 1.32573 12.4639 1.52852C12.6717 1.72624 12.7757 2.02281 12.7757 2.41825V11.5817C12.7757 11.9772 12.6717 12.2763 12.4639 12.4791C12.2611 12.6768 11.9721 12.7757 11.597 12.7757H2.40304ZM4.03042 7.63498H9.9924C10.2053 7.63498 10.3777 7.58175 10.5095 7.47529C10.6464 7.36375 10.7148 7.20659 10.7148 7.0038C10.7148 6.80101 10.6489 6.64385 10.5171 6.53232C10.3904 6.41572 10.2155 6.35741 9.9924 6.35741H4.03042C3.80735 6.35741 3.62991 6.41572 3.4981 6.53232C3.36629 6.64385 3.30038 6.80101 3.30038 7.0038C3.30038 7.20659 3.36882 7.36375 3.5057 7.47529C3.64259 7.58175 3.81749 7.63498 4.03042 7.63498Z'
            fill='currentColor'
        />
    </svg>
);
const FolderIcon = () => (
    <svg
        color='rgb(var(--foreground, 0, 0, 0))'
        viewBox='0 0 18 16'
        fill='none'
        xmlns='http://www.w3.org/2000/svg'
    >
        <path
            d='M2.48877 15.5H15.749C16.4571 15.5 17.0092 15.2869 17.4055 14.8607C17.8018 14.4399 18 13.806 18 12.959V4.54098C18 3.69945 17.7913 3.06557 17.3738 2.63934C16.9564 2.21311 16.3355 2 15.5112 2H7.90225C7.63276 2 7.40555 1.96448 7.22061 1.89344C7.03567 1.81694 6.8428 1.69126 6.64201 1.51639L6.15852 1.10656C5.98415 0.953552 5.81506 0.833333 5.65125 0.745902C5.49273 0.65847 5.31572 0.595628 5.12021 0.557377C4.92999 0.519126 4.70542 0.5 4.4465 0.5H2.18758C1.49009 0.5 0.951123 0.704918 0.570674 1.11475C0.190225 1.52459 0 2.14208 0 2.96721V12.959C0 13.806 0.206077 14.4399 0.61823 14.8607C1.03567 15.2869 1.65918 15.5 2.48877 15.5ZM2.50462 14.1803C2.10832 14.1803 1.80449 14.0738 1.59313 13.8607C1.38177 13.6421 1.27609 13.3197 1.27609 12.8934V3.04098C1.27609 2.63661 1.37649 2.3306 1.57728 2.12295C1.77807 1.9153 2.06869 1.81148 2.44914 1.81148H4.12153C4.38573 1.81148 4.60766 1.84973 4.78732 1.92623C4.97226 2.00273 5.16513 2.12842 5.36592 2.30328L5.84941 2.72131C6.01849 2.86885 6.18494 2.98634 6.34874 3.07377C6.51255 3.1612 6.69221 3.22404 6.88771 3.26229C7.08322 3.30055 7.31044 3.31967 7.56935 3.31967H15.4874C15.8785 3.31967 16.1823 3.42896 16.3989 3.64754C16.6156 3.86612 16.7239 4.18852 16.7239 4.61475V12.9016C16.7239 13.3224 16.6156 13.6421 16.3989 13.8607C16.1823 14.0738 15.8785 14.1803 15.4874 14.1803H2.50462ZM0.77675 6.31967H17.2153V5.08197H0.77675V6.31967Z'
            fill='currentColor'
        />
    </svg>
);
const BookIcon = () => (
    <svg
        color='rgb(var(--foreground, 0, 0, 0))'
        viewBox='0 0 13 18'
        fill='none'
        xmlns='http://www.w3.org/2000/svg'
    >
        <path
            d='M2.37277 17.5H12.3817C12.5517 17.5 12.696 17.4365 12.8145 17.3096C12.9382 17.188 13 17.0399 13 16.8654C13 16.7279 12.9588 16.6009 12.8763 16.4846C12.7939 16.3735 12.6908 16.2969 12.5672 16.2545C12.2426 16.1223 12.0081 15.9055 11.8639 15.6041C11.7247 15.3079 11.6912 14.98 11.7634 14.6204C11.8355 14.2555 12.0313 13.9064 12.3508 13.5733C12.495 13.4252 12.6393 13.2401 12.7836 13.018C12.9279 12.7958 13 12.4865 13 12.0898V2.9909C13 2.16589 12.799 1.54449 12.3971 1.12669C12.0004 0.708897 11.4027 0.5 10.604 0.5H2.39596C1.5973 0.5 0.997027 0.708897 0.595125 1.12669C0.198375 1.5392 0 2.1606 0 2.9909V15.0488C0 15.8632 0.198375 16.474 0.595125 16.8812C0.991875 17.2937 1.58442 17.5 2.37277 17.5ZM1.24435 12.9148V3.0147C1.24435 2.61806 1.34483 2.31397 1.54578 2.10243C1.75188 1.8856 2.05331 1.77718 2.45006 1.77718H10.5422C10.9441 1.77718 11.2455 1.8856 11.4465 2.10243C11.6526 2.31397 11.7556 2.61806 11.7556 3.0147V11.9153C11.7556 12.3648 11.5315 12.5896 11.0832 12.5896H2.50416C2.25168 12.5896 2.01982 12.6187 1.80856 12.6769C1.60246 12.7297 1.41439 12.8091 1.24435 12.9148ZM2.44233 16.2228C2.05073 16.2228 1.75188 16.1197 1.54578 15.9134C1.34483 15.7072 1.24435 15.4163 1.24435 15.0408C1.24435 14.6865 1.35771 14.4036 1.58442 14.192C1.81629 13.9752 2.12545 13.8668 2.51189 13.8668H10.4417C10.5396 13.8668 10.6298 13.8588 10.7122 13.843C10.5319 14.2555 10.452 14.668 10.4727 15.0805C10.4984 15.4983 10.6143 15.8791 10.8205 16.2228H2.44233ZM2.15636 13.2718H3.16885V1.4678H2.15636V13.2718Z'
            fill='currentColor'
        />
    </svg>
);
const BookmarkIcon = () => (
    <svg
        color='rgb(var(--foreground, 0, 0, 0))'
        viewBox='0 0 11 18'
        fill='none'
        xmlns='http://www.w3.org/2000/svg'
    >
        <path
            d='M0.864985 17.5C1.06083 17.5 1.2458 17.434 1.41988 17.3019C1.59397 17.1751 1.86597 16.9373 2.2359 16.5886L5.42656 13.5373C5.47552 13.4845 5.52448 13.4845 5.57344 13.5373L8.76409 16.5886C9.13403 16.932 9.40331 17.1698 9.57196 17.3019C9.74604 17.434 9.93373 17.5 10.135 17.5C10.407 17.5 10.6192 17.4155 10.7715 17.2464C10.9238 17.0773 11 16.8395 11 16.5331V2.77459C11 2.01904 10.8069 1.45105 10.4206 1.07063C10.0344 0.69021 9.45772 0.5 8.69065 0.5H2.30935C1.54228 0.5 0.965628 0.69021 0.579377 1.07063C0.193126 1.45105 0 2.01904 0 2.77459V16.5331C0 16.8395 0.0761622 17.0773 0.228487 17.2464C0.380811 17.4155 0.592977 17.5 0.864985 17.5ZM1.53412 15.3601C1.47428 15.413 1.41716 15.4315 1.36276 15.4156C1.3138 15.4051 1.28932 15.3601 1.28932 15.2809V2.79044C1.28932 2.44701 1.37908 2.18811 1.55861 2.01375C1.74357 1.83939 2.01558 1.75221 2.37463 1.75221H8.63353C8.98714 1.75221 9.25371 1.83939 9.43323 2.01375C9.6182 2.18811 9.71068 2.44701 9.71068 2.79044V15.2809C9.71068 15.3601 9.68348 15.4051 9.62908 15.4156C9.58012 15.4315 9.52572 15.413 9.46588 15.3601L5.93249 12.0315C5.80193 11.9099 5.65776 11.8492 5.5 11.8492C5.34224 11.8492 5.19807 11.9099 5.06751 12.0315L1.53412 15.3601Z'
            fill='currentColor'
        />
    </svg>
);

const Nest = ({ category }: { category: Category }) => {
    const { useNavigate, useLocation } = useVibeContext();
    const navigate = useNavigate();
    const location = useLocation();
    return category.type === "file" ? (
        <div
            data-toggled={location.pathname === category.path}
            className='header'
            onClick={() => navigate(category.path || "/")}
        >
            <div style={{ height: "10px", width: "10px", marginRight: "5px" }} />
            <div>
                <BookmarkIcon />
            </div>
            {category.name}
        </div>
    ) : (
        <Folder category={category} />
    );
};

export const Tree = ({ data }: { data: Category[] }) => {
    const id = useId();
    return (
        <div>
            {data.map((category, i) => (
                <Nest category={category} key={`${id}-${i}`} />
            ))}
        </div>
    );
};

const Folder = ({ category }: { category: Category }) => {
    const [open, setOpen] = React.useState(false);
    const id = useId();
    return (
        <div>
            <div className='header' onClick={() => setOpen((o) => !o)}>
                <div style={{ height: "10px", width: "10px", marginRight: "5px" }}>
                    {open ? <MinusSquareIcon /> : <PlusSquareIcon />}
                </div>
                <div>
                    {category.children.some((i) => i.type === "file") ? (
                        <BookIcon />
                    ) : (
                        <FolderIcon />
                    )}
                </div>
                {category.name}
            </div>
            {open && (
                <div style={{ marginLeft: "14px", borderLeft: "1px solid hsl(var(--accent-100))" }}>
                    {category.children.map((child, i) => (
                        <Nest category={child} key={`${id}-${i}`} />
                    ))}
                </div>
            )}
        </div>
    );
};
