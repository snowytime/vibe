<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta name="description" content="Lets Vibe ðŸ”¥" />
        <meta charset="UTF-8" />
        <link rel="shortcut icon" href="/public/32.png" />
        <link rel="apple-touch-icon-precomposed" sizes="180x180" href="/public/180.png" />
        <link rel="icon" sizes="32x32" href="/public/32.png" />
        <link rel="icon" sizes="16x16" href="/public/16.png" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Vibe</title>
        <style type="text/css" data-intent="vibe">
            @import "@snowytime/css/fonts/visby/all.css";
            @import "@snowytime/css/presets/visby.css";
        </style>
    </head>

    <script defer>
        const headObserver = new MutationObserver(() => {
            [...document.head.children].forEach((child) => {
                if (
                    child.tagName === "STYLE" ||
                    (child.tagName === "LINK" &&
                        (child.getAttribute("type") === "text/css" ||
                            child.getAttribute("rel") === "stylesheet"))
                ) {
                    // stylesheet
                    const getIntent = () => {
                        const isDev = !!child.getAttribute("data-vite-dev-id");
                        if (isDev) {
                            return /use:\s*vibe/.test(child.textContent)
                                ? "vibe"
                                : /use:\s*universal/.test(child.textContent)
                                ? "universal"
                                : "story";
                        }
                        return child.getAttribute("data-intent") || "story";
                    };

                    if (getIntent() === "story") {
                        child.disabled = true;
                    }
                }
            });
        });
        headObserver.observe(document.head, {
            subtree: true,
            characterData: true,
            childList: true,
        });
    </script>

    <body>
        <div id="_vibe"></div>
        <script type="module" src="/src/root.tsx"></script>
    </body>
</html>

<!--
const headObserver = new MutationObserver(() => {
                // handler
                [...(document.head.children as any)].forEach((child) => {
            if (
                child.tagName === "STYLE" ||
                (child.tagName === "LINK" &&
                    (child.getAttribute("type") === "text/css" ||
                        child.getAttribute("rel") === "stylesheet"))
            ) {
                // remove it from the vibe main styles if it does not pertain to globals
                const href = child.getAttribute("href");
                const devId = child.getAttribute("data-vite-dev-id");
                const storyId = child.getAttribute("data-story");

                // we loop over all the
                if (
                    (href && globalRegistry.some((str) => href.includes(str))) ||
                    (devId && globalRegistry.some((str) => devId.includes(str)))
                ) {
                    // Leave this stylesheet in the main document head
                    return;
                }
                child.disabled = true;
            }
        });
            });
            headObserver.observe(document.head, {
                subtree: true,
                characterData: true,
                childList: true,
            });
 -->
